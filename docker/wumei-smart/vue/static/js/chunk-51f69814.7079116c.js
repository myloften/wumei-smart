(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-51f69814","chunk-e14bc6fc","chunk-2d0a3715"],{"01ca":function(t,e,i){"use strict";i.d(e,"f",(function(){return s})),i.d(e,"d",(function(){return a})),i.d(e,"a",(function(){return o})),i.d(e,"e",(function(){return r})),i.d(e,"g",(function(){return l})),i.d(e,"c",(function(){return c})),i.d(e,"b",(function(){return u}));var n=i("b775");function s(t){return Object(n["a"])({url:"/iot/model/list",method:"get",params:t})}function a(t){return Object(n["a"])({url:"/iot/model/"+t,method:"get"})}function o(t){return Object(n["a"])({url:"/iot/model",method:"post",data:t})}function r(t){return Object(n["a"])({url:"/iot/model/import",method:"post",data:t})}function l(t){return Object(n["a"])({url:"/iot/model",method:"put",data:t})}function c(t){return Object(n["a"])({url:"/iot/model/"+t,method:"delete"})}function u(t){return Object(n["a"])({url:"/iot/model/cache/"+t,method:"get"})}},"05c0":function(t,e,i){t.exports=i.p+"static/img/esp32.ad398494.jpg"},1:function(t,e){},2:function(t,e){},3:function(t,e){},"32d1":function(t,e,i){t.exports=i.p+"static/img/product.22ba6f31.jpg"},4:function(t,e){},5:function(t,e){},"584f":function(t,e,i){"use strict";i.d(e,"g",(function(){return s})),i.d(e,"f",(function(){return a})),i.d(e,"d",(function(){return o})),i.d(e,"e",(function(){return r})),i.d(e,"a",(function(){return l})),i.d(e,"h",(function(){return c})),i.d(e,"b",(function(){return u})),i.d(e,"c",(function(){return d}));var n=i("b775");function s(t){return Object(n["a"])({url:"/iot/device/shortList",method:"get",params:t})}function a(t){return Object(n["a"])({url:"/iot/device/all",method:"get",params:t})}function o(t){return Object(n["a"])({url:"/iot/device/"+t,method:"get"})}function r(t){return Object(n["a"])({url:"/iot/device/runningStatus/"+t,method:"get"})}function l(t){return Object(n["a"])({url:"/iot/device",method:"post",data:t})}function c(t){return Object(n["a"])({url:"/iot/device",method:"put",data:t})}function u(t){return Object(n["a"])({url:"/iot/device/"+t,method:"delete"})}function d(){return Object(n["a"])({url:"/iot/device/generator",method:"get"})}},6:function(t,e){},"6bd6":function(t,e,i){t.exports=i.p+"static/img/raspberry.ff3a74da.jpg"},"7d04":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("span")},s=[],a=(i("b0c0"),i("d3b7"),i("25f0"),i("a15b"),i("e7fc")),o=i.n(a),r=i("5f87"),l={name:"mqttClient",props:{publish:{type:Object,default:null},subscribes:{type:Array,default:null}},watch:{publish:function(t,e){this.mqttPublish(t.topic,t.message,t.name)},subscribes:function(t,e){this.connectMqtt(t)}},data:function(){return{deviceInfo:{}}},created:function(){},methods:{connectMqtt:function(t){var e=this,i={username:"wumei-smart",password:Object(r["a"])(),cleanSession:!1,keepAlive:30,clientId:"web-"+Math.random().toString(16).substr(2),connectTimeout:6e4},n="ws://"+window.location.hostname+":8083/mqtt";console.log("mqtt地址：",n),this.client=o.a.connect(n,i),this.client.on("connect",(function(i){console.log("成功连接服务器:",i),e.client.subscribe(t,{qos:1},(function(e){e?console.log("消息订阅失败！"):(console.log("订阅成功"),console.log(t.join(", ")))}))})),this.reconnectMqtt(),this.mqttError(),this.mqttSubscribe()},mqttPublish:function(t,e,i){var n=this;if(!this.client.connected)return console.log("客户端未连接"),void this.$modal.notifyError("Mqtt客户端未连接");this.client.publish(t,e,{qos:1},(function(s){s||(console.log("成功发布主题："+t),console.log("主题内容："+e),n.$modal.notifySuccess("[ "+i+" ] 指令发送成功"))}))},mqttSubscribe:function(){var t=this;this.client.on("message",(function(e,i){console.log("收到来自",e,"的信息",i.toString());var n={};n.topic=e,n.message=JSON.parse(i.toString()),t.$emit("callbackEvent",n)}))},mqttError:function(){var t=this;this.client.on("error",(function(e){console.log("连接失败：",e),t.$modal.notifyError("Mqtt客户端连接失败"),t.client.end()}))},unsubscribeMqtt:function(){var t=this;this.client.unsubscribe(this.mtopic,(function(e){console.log("主题为"+t.mtopic+"取消订阅成功",e)}))},unconnectMqtt:function(){this.client.end(),this.client=null,console.log("服务器已断开连接！"),this.$modal.notifyError("Mqtt服务器已断开连接！")},reconnectMqtt:function(){this.client.on("reconnect",(function(t){console.log("正在重连:",t)}))}}},c=l,u=i("2877"),d=Object(u["a"])(c,n,s,!1,null,null,null);e["default"]=d.exports},"85c5":function(t,e,i){t.exports=i.p+"static/img/esp8266.4dff6d56.jpg"},9153:function(t,e,i){t.exports=i.p+"static/img/computer.53fe4554.jpg"},c572:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{padding:"6px"}},[n("el-card",{staticStyle:{"margin-bottom":"6px"}},[n("el-form",{ref:"queryForm",staticStyle:{"margin-bottom":"-20px"},attrs:{model:t.queryParams,inline:!0,"label-width":"75px"}},[n("el-form-item",{attrs:{label:"设备名称",prop:"deviceName"}},[n("el-input",{attrs:{placeholder:"请输入设备名称",clearable:"",size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleQuery(e)}},model:{value:t.queryParams.deviceName,callback:function(e){t.$set(t.queryParams,"deviceName",e)},expression:"queryParams.deviceName"}})],1),n("el-form-item",{attrs:{label:"产品名称",prop:"productName"}},[n("el-input",{attrs:{placeholder:"请输入产品名称",clearable:"",size:"small"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleQuery(e)}},model:{value:t.queryParams.productName,callback:function(e){t.$set(t.queryParams,"productName",e)},expression:"queryParams.productName"}})],1),n("el-form-item",{attrs:{label:"设备状态",prop:"status"}},[n("el-select",{attrs:{placeholder:"请选择设备状态",clearable:"",size:"small"},model:{value:t.queryParams.status,callback:function(e){t.$set(t.queryParams,"status",e)},expression:"queryParams.status"}},t._l(t.dict.type.iot_device_status,(function(t){return n("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),n("el-form-item",{attrs:{label:"激活时间"}},[n("el-date-picker",{staticStyle:{width:"240px"},attrs:{size:"small","value-format":"yyyy-MM-dd",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.daterangeActiveTime,callback:function(e){t.daterangeActiveTime=e},expression:"daterangeActiveTime"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:t.handleQuery}},[t._v("搜索")]),n("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:t.resetQuery}},[t._v("重置")])],1),n("el-form-item",{staticStyle:{float:"right"}},[n("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:add"],expression:"['iot:device:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:function(e){return t.handleEditDevice(0)}}},[t._v("新增")])],1)],1)],1),n("el-card",{staticStyle:{"padding-bottom":"100px"}},[n("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{gutter:30}},t._l(t.deviceList,(function(e,s){return n("el-col",{key:s,staticStyle:{"margin-bottom":"30px","text-align":"center"},attrs:{xs:24,sm:12,md:12,lg:8,xl:6}},[n("el-card",{attrs:{"body-style":{padding:"20px"},shadow:"always"}},[n("el-row",{attrs:{type:"flex",gutter:10,justify:"space-between"}},[n("el-col",{staticStyle:{"text-align":"left"},attrs:{span:20}},[n("el-link",{staticStyle:{"font-weight":"bold","font-size":"16px","line-height":"32px"},attrs:{type:"",underline:!1},on:{click:function(i){return t.handleEditDevice(e)}}},[n("svg-icon",{attrs:{"icon-class":"device"}}),t._v(" "+t._s(e.deviceName)+" "),n("el-tag",{attrs:{size:"mini",type:"info"}},[t._v("Version "+t._s(e.firmwareVersion))])],1)],1),n("el-col",{attrs:{span:4}},[n("div",{staticStyle:{"font-size":"28px",color:"#ccc"}},[3==e.status&&e.rssi>="-55"?n("svg-icon",{attrs:{"icon-class":"wifi_4"}}):3==e.status&&e.rssi>="-70"&&e.rssi<"-55"?n("svg-icon",{attrs:{"icon-class":"wifi_3"}}):3==e.status&&e.rssi>="-85"&&e.rssi<"-70"?n("svg-icon",{attrs:{"icon-class":"wifi_2"}}):3==e.status&&e.rssi>="-100"&&e.rssi<"-85"?n("svg-icon",{attrs:{"icon-class":"wifi_1"}}):n("svg-icon",{attrs:{"icon-class":"wifi_0"}})],1)])],1),n("el-row",{attrs:{gutter:10}},[n("el-col",{attrs:{span:15}},[n("div",{staticStyle:{"text-align":"left","line-height":"40px","font-size":"14px"}},[n("dict-tag",{staticStyle:{width:"60px",display:"inline-block"},attrs:{options:t.dict.type.iot_device_status,value:e.status,size:"small"}}),1==e.isShadow?n("el-tag",{attrs:{type:"success",size:"small"}},[t._v("启用影子")]):n("el-tag",{attrs:{type:"info",size:"small"}},[t._v("禁用影子")])],1),n("el-descriptions",{attrs:{column:1,size:"mini"}},[n("el-descriptions-item",{attrs:{label:"编号"}},[t._v(" "+t._s(e.serialNumber)+" ")]),n("el-descriptions-item",{attrs:{label:"产品"}},[t._v(" "+t._s(e.productName)+" ")]),n("el-descriptions-item",{attrs:{label:"激活时间"}},[t._v(" "+t._s(t.parseTime(e.activeTime,"{y}-{m}-{d}"))+" ")])],1)],1),n("el-col",{attrs:{span:9}},[n("div",{staticStyle:{"margin-top":"10px"}},[null!=e.imgUrl&&""!=e.imgUrl?n("el-image",{staticStyle:{width:"100%",height:"100px",border:"1px solid #ccc","border-radius":"5px"},attrs:{lazy:"","preview-src-list":[t.baseUrl+e.imgUrl],src:t.baseUrl+e.imgUrl,fit:"cover"}}):-1!=e.productName.indexOf("ESP8266")?n("el-image",{staticStyle:{width:"100%",height:"100px",border:"1px solid #ccc","border-radius":"5px"},attrs:{"preview-src-list":[i("85c5")],src:i("85c5"),fit:"cover"}}):-1!=e.productName.indexOf("ESP32")?n("el-image",{staticStyle:{width:"100%",height:"100px",border:"1px solid #ccc","border-radius":"5px"},attrs:{"preview-src-list":[i("05c0")],src:i("05c0"),fit:"cover"}}):-1!=e.productName.indexOf("Raspberry")?n("el-image",{staticStyle:{width:"100%",height:"100px",border:"1px solid #ccc","border-radius":"5px"},attrs:{"preview-src-list":[i("6bd6")],src:i("6bd6"),fit:"cover"}}):-1!=e.productName.indexOf("Phone")?n("el-image",{staticStyle:{width:"100%",height:"100px",border:"1px solid #ccc","border-radius":"5px"},attrs:{"preview-src-list":[i("cc78")],src:i("cc78"),fit:"cover"}}):-1!=e.productName.indexOf("Computer")?n("el-image",{staticStyle:{width:"100%",height:"100px",border:"1px solid #ccc","border-radius":"5px"},attrs:{"preview-src-list":[i("9153")],src:i("9153"),fit:"cover"}}):n("el-image",{staticStyle:{width:"100%",height:"100px",border:"1px solid #ccc","border-radius":"5px"},attrs:{"preview-src-list":[i("32d1")],src:i("32d1"),fit:"cover"}})],1)])],1),n("el-descriptions",{staticStyle:{height:"82px","margin-top":"10px",overflow:"hidden"},attrs:{column:2,border:"",size:"mini"}},[t._l(e.readOnlyList,(function(e){return n("el-descriptions-item",{key:e.id,attrs:{contentStyle:{height:"40px"}}},[n("template",{slot:"label"},[n("span",{staticStyle:{"white-space":"nowrap","text-overflow":"ellipsis","min-width":"48px",overflow:"hidden",height:"40px"}},[t._v(t._s(e.name))])]),n("el-link",{staticStyle:{"white-space":"nowrap"},attrs:{type:"primary",underline:!1}},[t._v(t._s(""==e.shadow?"0":e.shadow)+" "+t._s(null==e.unit?"":e.unit))])],2)})),t._l(e.boolList,(function(i){return n("el-descriptions-item",{key:i.id,attrs:{contentStyle:{height:"40px"}}},[n("template",{slot:"label"},[n("div",{staticStyle:{"white-space":"nowrap","text-overflow":"ellipsis","min-width":"48px",overflow:"hidden"},attrs:{title:i.name}},[t._v(t._s(i.name))])]),n("el-switch",{attrs:{"active-value":"1","inactive-value":"0",disabled:t.shadowUnEnable(e)},on:{change:function(n){return t.publishThingsModel(e,i)}},model:{value:i.shadow,callback:function(e){t.$set(i,"shadow",e)},expression:"subItem.shadow"}})],2)})),t._l(e.enumList,(function(i){return n("el-descriptions-item",{key:i.id,attrs:{contentStyle:{height:"40px"}}},[n("template",{slot:"label"},[n("div",{staticStyle:{"white-space":"nowrap","text-overflow":"ellipsis","min-width":"48px",overflow:"hidden"},attrs:{title:i.name}},[t._v(t._s(i.name))])]),n("el-select",{attrs:{placeholder:"请选择",clearable:"",size:"mini",title:i.name,disabled:t.shadowUnEnable(e)},on:{change:function(n){return t.publishThingsModel(e,i)}},model:{value:i.shadow,callback:function(e){t.$set(i,"shadow",e)},expression:"subItem.shadow"}},t._l(i.enumList,(function(t){return n("el-option",{key:t.value,attrs:{label:t.text,value:t.value}})})),1)],2)})),t._l(e.decimalList,(function(i){return n("el-descriptions-item",{key:i.id,attrs:{contentStyle:{height:"40px"}}},[n("template",{slot:"label"},[n("div",{staticStyle:{"white-space":"nowrap","text-overflow":"ellipsis","min-width":"48px",overflow:"hidden"},attrs:{title:i.name}},[t._v(t._s(i.name))])]),n("el-input",{attrs:{placeholder:"小数："+i.name,size:"mini",title:"小数："+i.name,disabled:t.shadowUnEnable(e)},model:{value:i.shadow,callback:function(e){t.$set(i,"shadow",e)},expression:"subItem.shadow"}},[n("el-button",{staticStyle:{"font-size":"16px",padding:"10px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(n){return t.publishThingsModel(e,i)}},slot:"append"})],1)],2)})),t._l(e.integerList,(function(i){return n("el-descriptions-item",{key:i.id,attrs:{contentStyle:{height:"40px"}}},[n("template",{slot:"label"},[n("div",{staticStyle:{"white-space":"nowrap","text-overflow":"ellipsis","min-width":"48px",overflow:"hidden"},attrs:{title:i.name}},[t._v(t._s(i.name))])]),n("el-input",{attrs:{placeholder:"整数："+i.name,title:"整数："+i.name,size:"mini",disabled:t.shadowUnEnable(e)},model:{value:i.shadow,callback:function(e){t.$set(i,"shadow",e)},expression:"subItem.shadow"}},[n("el-button",{staticStyle:{"font-size":"16px",padding:"10px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(n){return t.publishThingsModel(e,i)}},slot:"append"})],1)],2)})),t._l(e.arrayList,(function(i){return n("el-descriptions-item",{key:i.id,attrs:{contentStyle:{height:"40px"}}},[n("template",{slot:"label"},[n("div",{staticStyle:{"white-space":"nowrap","text-overflow":"ellipsis","min-width":"48px",overflow:"hidden"},attrs:{title:i.name}},[t._v(t._s(i.name))])]),n("el-input",{attrs:{placeholder:"数组："+i.name,title:"数组："+i.name,size:"mini",disabled:t.shadowUnEnable(e)},model:{value:i.shadow,callback:function(e){t.$set(i,"shadow",e)},expression:"subItem.shadow"}},[n("el-button",{staticStyle:{"font-size":"16px",padding:"10px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(n){return t.publishThingsModel(e,i)}},slot:"append"})],1)],2)})),t._l(e.stringList,(function(i){return n("el-descriptions-item",{key:i.id,attrs:{contentStyle:{height:"40px"}}},[n("template",{slot:"label"},[n("div",{staticStyle:{"white-space":"nowrap","text-overflow":"ellipsis","min-width":"48px",overflow:"hidden"},attrs:{title:i.name}},[t._v(t._s(i.name))])]),n("el-input",{attrs:{placeholder:"字符串："+i.name,title:"字符串："+i.name,size:"mini",disabled:t.shadowUnEnable(e)},model:{value:i.shadow,callback:function(e){t.$set(i,"shadow",e)},expression:"subItem.shadow"}},[n("el-button",{staticStyle:{"font-size":"16px",padding:"10px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(n){return t.publishThingsModel(e,i)}},slot:"append"})],1)],2)}))],2),n("el-button-group",{staticStyle:{"margin-top":"15px"}},[n("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:edit"],expression:"['iot:device:edit']"}],attrs:{type:"primary",size:"mini",icon:"el-icon-edit"},on:{click:function(i){return t.handleEditDevice(e)}}},[t._v("详情 ")]),n("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:remove"],expression:"['iot:device:remove']"}],attrs:{type:"danger",size:"mini",icon:"el-icon-delete"},on:{click:function(i){return t.handleDelete(e)}}},[t._v("删除")]),n("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:device:edit"],expression:"['iot:device:edit']"}],attrs:{type:"success",size:"mini",icon:"el-icon-odometer",disabled:3!=e.status},on:{click:function(i){return t.handleMonitor(e)}}},[t._v("实时监测")])],1)],1)],1)})),1),n("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.queryParams.pageNum,limit:t.queryParams.pageSize},on:{"update:page":function(e){return t.$set(t.queryParams,"pageNum",e)},"update:limit":function(e){return t.$set(t.queryParams,"pageSize",e)},pagination:t.getList}}),n("el-dialog",{attrs:{title:"实时监测",visible:t.open,width:"800px"},on:{"update:visible":function(e){t.open=e}}},[n("div",{staticStyle:{"margin-top":"-50px"}},[n("el-divider")],1),n("el-form",{attrs:{inline:!0,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"监测间隔(ms)"}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"取值范围500-10000毫秒",placement:"top"}},[n("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入监测间隔",type:"number",clearable:"",size:"small"},model:{value:t.monitorInterval,callback:function(e){t.monitorInterval=e},expression:"monitorInterval"}})],1)],1),n("el-form-item",{attrs:{label:"监测次数"}},[n("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"取值方位1-300",placement:"top"}},[n("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请输入监测次数",type:"number",clearable:"",size:"small"},model:{value:t.monitorNumber,callback:function(e){t.monitorNumber=e},expression:"monitorNumber"}})],1)],1),n("el-form-item",[n("el-button",{staticStyle:{"margin-left":"30px"},attrs:{type:"success",icon:"el-icon-refresh",size:"mini",disabled:3!=t.monitorDevice.status},on:{click:function(e){return t.updateMonitorParameters()}}},[t._v("更 新")])],1)],1),n("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.chartLoading,expression:"chartLoading"}],attrs:{gutter:20,"element-loading-text":"正在接收设备数据，请耐心等待......","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},t._l(t.monitorThings,(function(t,e){return n("el-col",{key:e,staticStyle:{"margin-bottom":"20px"},attrs:{span:12}},[n("el-card",{attrs:{shadow:"hover","body-style":{paddingTop:"10px",marginBottom:"-20px"}}},[n("div",{ref:"monitor",refInFor:!0,staticStyle:{height:"210px",padding:"0"}})])],1)})),1),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:t.cancel}},[t._v("关 闭")])],1)],1),n("mqttClient",{ref:"mqttClient",attrs:{publish:t.publish,subscribes:t.subscribes},on:{callbackEvent:function(e){return t.mqttCallback(e)}}})],1)],1)},s=[],a=(i("a9e3"),i("b0c0"),i("ac1f"),i("1276"),i("4de4"),i("d3b7"),i("313e")),o=i("7d04"),r=i("584f"),l=i("01ca"),c={name:"Device",dicts:["iot_device_status","iot_is_enable"],components:{mqttClient:o["default"]},data:function(){return{monitorInterval:1e3,monitorNumber:30,monitorDevice:{},publish:{},subscribes:[],chart:[],dataList:[],monitorThings:[],client:{},loading:!0,chartLoading:!0,total:0,deviceList:[],title:"",open:!1,daterangeActiveTime:[],queryParams:{pageNum:1,pageSize:10,deviceName:null,productId:null,groupId:null,productName:null,userId:null,userName:null,tenantId:null,tenantName:null,serialNumber:null,status:null,networkAddress:null,activeTime:null}}},created:function(){this.getList()},activated:function(){var t=this.$route.query.t;if(null!=t&&t!=this.uniqueId){this.uniqueId=t,this.queryParams.pageNum=Number(this.$route.query.pageNum);var e=this.$route.query.productId;null!=e&&(this.queryParams.productId=Number(e)),this.getList()}},methods:{publishThingsModel:function(t,e){var i=this;Object(l["b"])(t.productId).then((function(n){for(var s=JSON.parse(n.data),a=0,o=0;o<s.functions.length;o++)if(e.id==s.functions[o].id){a=2;break}if(0==a)for(var r=0;r<s.properties.length;r++)if(e.id==s.properties[r].id){a=1;break}0!=a&&i.mqttPublish(a,t,e)}))},mqttPublish:function(t,e,i){var n="",s="";if(1==t)3==e.status?n="/"+e.productId+"/"+e.serialNumber+"/property-online/get":e.isShadow&&(n="/"+e.productId+"/"+e.serialNumber+"/property-offline/post"),s='[{"id":"'+i.id+'","value":"'+i.shadow+'"}]';else if(2==t)3==e.status?n="/"+e.productId+"/"+e.serialNumber+"/function-online/get":e.isShadow&&(n="/"+e.productId+"/"+e.serialNumber+"/function-offline/post"),s='[{"id":"'+i.id+'","value":"'+i.shadow+'"}]';else if(3==t)n="/"+e.productId+"/"+e.serialNumber+"/ota/get",s='{"version":1.1}';else{if(4!=t)return;n="/"+e.productId+"/"+e.serialNumber+"/monitor/get",s='{"count":'+i.value+',"interval":'+this.monitorInterval+"}"}""!=n&&(this.publish={topic:n,message:s,name:i.name})},mqttCallback:function(t){var e=[];e=t.topic.split("/");e[1];var i=e[2];if("status"==e[3]){for(var n=0;n<this.deviceList.length;n++)this.deviceList[n].serialNumber==i&&(this.deviceList[n].status=t.message.status,this.deviceList[n].isShadow=t.message.isShadow);this.monitorDevice.serialNumber==i&&(this.monitorDevice.status=t.message.status,this.monitorDevice.isShadow=t.message.isShadow)}else if("monitor"==e[3]){this.chartLoading=!1;for(var s=0;s<t.message.length;s++)for(var a=t.message[s].value,o=t.message[s].id,r=(t.message[s].remark,0);r<this.dataList.length;r++)o==this.dataList[r].id&&(this.dataList[r].length>50&&this.dataList[r].shift(),this.dataList[r].data.push([this.getTime(),a]),this.chart[r].setOption({series:[{data:this.dataList[r].data}]}))}},mqttSubscribe:function(t){for(var e=[],i=0;i<t.length;i++){var n="/"+t[i].productId+"/"+t[i].serialNumber+"/status/post",s="/"+t[i].productId+"/"+t[i].serialNumber+"/monitor/post";e.push(n),e.push(s)}this.subscribes=e},updateMonitorParameters:function(){for(var t=0;t<this.dataList.length;t++)this.dataList[t].data=[];(this.monitorInterval<500||this.monitorInterval>1e4)&&this.$modal.alertError("实时监测的间隔范围500-10000毫秒"),(0==this.monitorNumber||this.monitorNumber>300)&&this.$modal.alertError("实时监测数量范围1-300");var e={name:"更新实时监测"};e.value=this.monitorNumber,this.mqttPublish(4,this.monitorDevice,e),this.chartLoading=!0},handleMonitor:function(t){this.open=!0,this.monitorLoading=!0,this.monitorDevice=t,this.getCacheThingsModdel(t.productId);var e={name:""};e.value=this.monitorNumber,this.mqttPublish(4,t,e)},stopMonitor:function(){this.dataList=[],this.chartLoading=!0;var t={name:"",value:0};this.mqttPublish(4,this.monitorDevice,t)},getList:function(){var t=this;this.loading=!0,null!=this.daterangeActiveTime&&""!=this.daterangeActiveTime&&(this.queryParams.params["beginActiveTime"]=this.daterangeActiveTime[0],this.queryParams.params["endActiveTime"]=this.daterangeActiveTime[1]),-1===this.$store.state.user.roles.indexOf("admin")&&(this.queryParams.userName=this.$store.state.user.name),Object(r["g"])(this.queryParams).then((function(e){t.deviceList=e.rows,t.total=e.total,t.mqttSubscribe(t.deviceList),t.loading=!1}))},cancel:function(){this.open=!1,this.stopMonitor()},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.daterangeActiveTime=[],this.queryParams.productId=null,this.resetForm("queryForm"),this.handleQuery()},handleEditDevice:function(t){var e=0;0!=t&&(e=t.deviceId||this.ids),this.$router.push({path:"/iot/device-edit",query:{deviceId:e,pageNum:this.queryParams.pageNum}})},handleDelete:function(t){var e=this,i=t.deviceId||this.ids;this.$modal.confirm('是否确认删除设备编号为"'+i+'"的数据项？').then((function(){return Object(r["b"])(i)})).then((function(){e.getList(),e.$modal.msgSuccess("删除成功")})).catch((function(){}))},shadowUnEnable:function(t){return 3!=t.status&&0==t.isShadow},getCacheThingsModdel:function(t){var e=this;Object(l["b"])(t).then((function(t){var i=JSON.parse(t.data);e.monitorThings=i.properties.filter((function(t){return 1==t.isMonitor}));for(var n=0;n<e.monitorThings.length;n++)e.dataList.push({id:e.monitorThings[n].id,name:e.monitorThings[n].name,data:[]});e.$nextTick((function(){this.getMonitorChart()}))}))},getMonitorChart:function(){for(var t=0;t<this.monitorThings.length;t++){var e;this.chart[t]=a["init"](this.$refs.monitor[t]),e={title:{left:"center",text:this.monitorThings[t].name+" 单位 "+(void 0!=this.monitorThings[t].datatype.unit?this.monitorThings[t].datatype.unit:"无")+"）",textStyle:{fontSize:14}},grid:{top:"40px",left:"20px",right:"20px",bottom:"10px",containLabel:!0},tooltip:{trigger:"axis",axisPointer:{animation:!0}},xAxis:{type:"time",show:!1,splitLine:{show:!1}},yAxis:{type:"value",boundaryGap:[0,"100%"],splitLine:{show:!0}},series:[{name:this.monitorThings[t].name,type:"line",showSymbol:!1,data:[]}]},e&&this.chart[t].setOption(e)}},getTime:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth()+1,n=t.getDate(),s=t.getHours(),a=t.getMinutes(),o=t.getSeconds();return i=i<10?"0"+i:i,n=n<10?"0"+n:n,s=s<10?"0"+s:s,e+"-"+i+"-"+n+" "+s+":"+a+":"+o}}},u=c,d=i("2877"),m=Object(d["a"])(u,n,s,!1,null,null,null);e["default"]=m.exports},cc78:function(t,e,i){t.exports=i.p+"static/img/telphone.adff42d3.jpg"}}]);