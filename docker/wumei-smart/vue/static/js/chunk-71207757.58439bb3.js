(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-71207757","chunk-e14bc6fc","chunk-7c561f93","chunk-10233db4","chunk-722c5e57","chunk-2d2082fa"],{1:function(e,t){},2:function(e,t){},2544:function(e,t,i){"use strict";i.d(t,"d",(function(){return a})),i.d(t,"c",(function(){return r})),i.d(t,"a",(function(){return o})),i.d(t,"e",(function(){return s})),i.d(t,"b",(function(){return l}));var n=i("b775");function a(e){return Object(n["a"])({url:"/iot/deviceUser/list",method:"get",params:e})}function r(e){return Object(n["a"])({url:"/iot/deviceUser/"+e,method:"get"})}function o(e){return Object(n["a"])({url:"/iot/deviceUser",method:"post",data:e})}function s(e){return Object(n["a"])({url:"/iot/deviceUser",method:"put",data:e})}function l(e){return Object(n["a"])({url:"/iot/deviceUser/"+e,method:"delete"})}},3:function(e,t){},"32d1":function(e,t,i){e.exports=i.p+"static/img/product.22ba6f31.jpg"},4:function(e,t){},5:function(e,t){},"584f":function(e,t,i){"use strict";i.d(t,"g",(function(){return a})),i.d(t,"f",(function(){return r})),i.d(t,"d",(function(){return o})),i.d(t,"e",(function(){return s})),i.d(t,"a",(function(){return l})),i.d(t,"h",(function(){return c})),i.d(t,"b",(function(){return u})),i.d(t,"c",(function(){return d}));var n=i("b775");function a(e){return Object(n["a"])({url:"/iot/device/shortList",method:"get",params:e})}function r(e){return Object(n["a"])({url:"/iot/device/all",method:"get",params:e})}function o(e){return Object(n["a"])({url:"/iot/device/"+e,method:"get"})}function s(e){return Object(n["a"])({url:"/iot/device/runningStatus/"+e,method:"get"})}function l(e){return Object(n["a"])({url:"/iot/device",method:"post",data:e})}function c(e){return Object(n["a"])({url:"/iot/device",method:"put",data:e})}function u(e){return Object(n["a"])({url:"/iot/device/"+e,method:"delete"})}function d(){return Object(n["a"])({url:"/iot/device/generator",method:"get"})}},"5f43":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"padding-left":"20px"}},[i("el-row",{attrs:{gutter:80}},[i("el-col",{attrs:{xs:24,sm:24,md:24,lg:10,xl:10}},[i("el-descriptions",{attrs:{column:1,border:"",title:e.title}},[i("el-descriptions-item",{attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("svg-icon",{attrs:{"icon-class":"ota"}}),e._v(" OTA升级 ")],1),i("el-link",{staticStyle:{"line-height":"28px","font-size":"16px","padding-right":"10px"},attrs:{underline:!1}},[e._v("Version "+e._s(e.deviceInfo.firmwareVersion))]),i("el-link",{staticStyle:{"font-size":"12px",display:"none"},attrs:{type:"success",underline:!1}},[e._v("已经是最新版本")]),i("el-button",{staticStyle:{float:"right"},attrs:{type:"success",size:"mini",disabled:3!=e.deviceInfo.status},on:{click:function(t){return e.otaUpgrade()}}},[e._v("升级")])],2),e._l(e.deviceInfo.boolList,(function(t,n){return i("el-descriptions-item",{key:n,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-open"}),e._v(" "+e._s(t.name)+" ")]),i("el-switch",{staticStyle:{"min-width":"100px"},attrs:{"active-text":"","inactive-text":"","active-value":"1","inactive-value":"0",disabled:e.shadowUnEnable},on:{change:function(i){return e.publishThingsModel(e.deviceInfo,t)}},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}})],2)})),e._l(e.deviceInfo.enumList,(function(t,n){return i("el-descriptions-item",{key:n,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-s-unfold"}),e._v(" "+e._s(t.name)+" ")]),i("el-select",{attrs:{placeholder:"请选择",clearable:"",disabled:e.shadowUnEnable},on:{change:function(i){return e.publishThingsModel(e.deviceInfo,t)}},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},e._l(t.enumList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],2)})),e._l(e.deviceInfo.stringList,(function(t,n){return i("el-descriptions-item",{key:n,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-tickets"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{placeholder:"请输入字符串",disabled:e.shadowUnEnable},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},[i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.publishThingsModel(e.deviceInfo,t)}},slot:"append"})],1)],2)})),e._l(e.deviceInfo.arrayList,(function(t,n){return i("el-descriptions-item",{key:n,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-tickets"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{placeholder:"请输入英文逗号分隔的字符串",disabled:e.shadowUnEnable},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},[i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.publishThingsModel(e.deviceInfo,t)}},slot:"append"})],1)],2)})),e._l(e.deviceInfo.decimalList,(function(t,n){return i("el-descriptions-item",{key:n,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{type:"number",placeholder:"请输入小数 ",disabled:e.shadowUnEnable},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},[i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.publishThingsModel(e.deviceInfo,t)}},slot:"append"})],1)],2)})),e._l(e.deviceInfo.integerList,(function(t,n){return i("el-descriptions-item",{key:n,attrs:{labelStyle:e.statusColor}},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-paperclip"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{type:"integer",placeholder:"请输入整数 ",disabled:e.shadowUnEnable},model:{value:t.shadow,callback:function(i){e.$set(t,"shadow",i)},expression:"item.shadow"}},[i("el-button",{staticStyle:{"font-size":"20px"},attrs:{slot:"append",icon:"el-icon-s-promotion",title:"指令发送"},on:{click:function(i){return e.publishThingsModel(e.deviceInfo,t)}},slot:"append"})],1)],2)}))],2),i("el-descriptions",{staticStyle:{margin:"40px 0"},attrs:{column:2,border:"",title:"监测数据"}},e._l(e.deviceInfo.readOnlyList,(function(t,n){return i("el-descriptions-item",{key:n},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-odometer"}),e._v(" "+e._s(t.name)+" ")]),i("el-link",{attrs:{type:"primary",underline:!1}},[e._v(e._s(t.shadow)+" "+e._s(null==t.unit?"":t.unit))])],2)})),1),1==e.deviceInfo.isShadow&&3!=e.deviceInfo.status?i("el-descriptions",{attrs:{column:1,border:"",size:"mini"}},[i("template",{slot:"title"},[i("span",{staticStyle:{"font-size":"14px",color:"#606266"}},[e._v("设备处于离线状态")])]),e._l(e.deviceInfo.boolList,(function(t,n){return i("el-descriptions-item",{key:n},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-open"}),e._v(" "+e._s(t.name)+" ")]),i("el-switch",{staticStyle:{"min-width":"100px"},attrs:{size:"mini","active-text":"","inactive-text":"","active-value":"1","inactive-value":"0",disabled:""},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}})],2)})),e._l(e.deviceInfo.enumList,(function(t,n){return i("el-descriptions-item",{key:n},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-s-unfold"}),e._v(" "+e._s(t.name)+" ")]),i("el-select",{attrs:{placeholder:"请选择",clearable:"",size:"mini",disabled:""},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}},e._l(t.enumList,(function(e){return i("el-option",{key:e.value,attrs:{label:e.text,value:e.value}})})),1)],2)})),e._l(e.deviceInfo.stringList,(function(t,n){return i("el-descriptions-item",{key:n},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-tickets"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{placeholder:"请输入字符串",size:"mini",disabled:""},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}})],2)})),e._l(e.deviceInfo.arrayList,(function(t,n){return i("el-descriptions-item",{key:n},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-tickets"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{placeholder:"请输入英文逗号分隔的字符串",size:"mini",disabled:""},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}})],2)})),e._l(e.deviceInfo.decimalList,(function(t,n){return i("el-descriptions-item",{key:n},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-star-off"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{type:"number",placeholder:"请输入小数",size:"mini",disabled:""},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}})],2)})),e._l(e.deviceInfo.integerList,(function(t,n){return i("el-descriptions-item",{key:n},[i("template",{slot:"label"},[i("i",{staticClass:"el-icon-paperclip"}),e._v(" "+e._s(t.name)+" ")]),i("el-input",{attrs:{type:"integer",placeholder:"请输入整数 ",size:"mini",disabled:""},model:{value:t.value,callback:function(i){e.$set(t,"value",i)},expression:"item.value"}})],2)}))],2):e._e(),i("mqtt-client",{ref:"mqttClient",attrs:{publish:e.publish,subscribes:e.subscribes},on:{callbackEvent:function(t){return e.mqttCallback(t)}}})],1),i("el-col",{attrs:{xs:24,sm:24,md:24,lg:14,xl:14}},[i("el-row",{staticStyle:{"background-color":"#F5F7FA",padding:"20px","padding-left":"10px"},attrs:{gutter:20}},e._l(e.deviceInfo.readOnlyList,(function(e,t){return i("el-col",{key:t,staticStyle:{"margin-bottom":"20px"},attrs:{xs:24,sm:12,md:12,lg:12,xl:8}},[i("el-card",{staticStyle:{"border-radius":"30px"},attrs:{shadow:"hover"}},[i("div",{ref:"map",refInFor:!0,staticStyle:{height:"230px",width:"180px",margin:"0 auto","margin-top":"-10px"}})])],1)})),1)],1)],1)],1)},a=[],r=(i("b0c0"),i("ac1f"),i("1276"),i("d81d"),i("584f")),o=i("01ca"),s=i("313e"),l=i("7d04"),c={name:"running-status",dicts:["iot_yes_no"],components:{mqttClient:l["default"]},props:{device:{type:Object,default:null}},watch:{device:function(e,t){var i=this;this.deviceInfo=e,this.deviceInfo&&0!=this.deviceInfo.deviceId&&Object(r["e"])(this.deviceInfo.deviceId).then((function(e){i.deviceInfo=e.data,i.updateDeviceStatus(i.deviceInfo),i.$nextTick((function(){this.MonitorChart()})),i.mqttSubscribe(i.deviceInfo)}))}},data:function(){return{publish:{},subscribes:[],title:"设备控制 ",shadowUnEnable:!1,statusColor:{background:"#67C23A",color:"#fff"},loading:!0,deviceInfo:{boolList:[],enumList:[],stringList:[],integerList:[],decimalList:[],arrayList:[],readonlyList:[]}}},created:function(){},methods:{publishThingsModel:function(e,t){var i=this;Object(o["b"])(e.productId).then((function(n){for(var a=JSON.parse(n.data),r=0,o=0;o<a.functions.length;o++)if(t.id==a.functions[o].id){r=2;break}if(0==r)for(var s=0;s<a.properties.length;s++)if(t.id==a.properties[s].id){r=1;break}0!=r&&i.mqttPublish(r,e,t)}))},mqttPublish:function(e,t,i){var n="",a="";if(1==e)3==t.status?n="/"+t.productId+"/"+t.serialNumber+"/property-online/get":t.isShadow&&(n="/"+t.productId+"/"+t.serialNumber+"/property-offline/post"),a='[{"id":"'+i.id+'","value":"'+i.shadow+'"}]';else if(2==e)3==t.status?n="/"+t.productId+"/"+t.serialNumber+"/function-online/get":t.isShadow&&(n="/"+t.productId+"/"+t.serialNumber+"/function-offline/post"),a='[{"id":"'+i.id+'","value":"'+i.shadow+'"}]';else{if(3!=e)return;n="/"+t.productId+"/"+t.serialNumber+"/ota/get",a='{"version":'+t.firmwareVersion+"}"}""!=n&&(this.publish={topic:n,message:a,name:i.name})},mqttCallback:function(e){var t=[];t=e.topic.split("/");t[1],t[2];"status"==t[3]&&(this.deviceInfo.status=e.message.status,this.deviceInfo.isShadow=e.message.isShadow,this.updateDeviceStatus(this.deviceInfo))},mqttSubscribe:function(e){var t="/"+e.productId+"/"+e.serialNumber+"/status/post";this.subscribes=[t]},updateDeviceStatus:function(e){3==e.status?(this.statusColor.background="#12d09f",this.title="设备控制（在线）"):1==e.isShadow?(this.statusColor.background="#409EFF",this.title="设备控制（影子模式）"):(this.statusColor.background="#909399",this.title="设备控制（设备不在线 未启用影子）",this.shadowUnEnable=!0)},otaUpgrade:function(){var e={name:"设备升级"};this.mqttPublish(3,this.deviceInfo,e)},MonitorChart:function(){for(var e=0;e<this.deviceInfo.readOnlyList.length;e++){var t,i=s["init"](this.$refs.map[e]);t={tooltip:{formatter:" {b} <br/> {c}"+this.deviceInfo.readOnlyList[e].unit},series:[{name:this.deviceInfo.readOnlyList[e].type,type:"gauge",min:this.deviceInfo.readOnlyList[e].min,max:this.deviceInfo.readOnlyList[e].max,colorBy:"data",splitNumber:10,radius:"100%",splitLine:{distance:4},axisLabel:{fontSize:10,distance:10},axisTick:{distance:4},axisLine:{lineStyle:{width:8,color:[[.2,"#409EFF"],[.8,"#12d09f"],[1,"#F56C6C"]],opacity:.3}},pointer:{icon:"triangle",length:"60%",width:7},progress:{show:!0,width:8},detail:{valueAnimation:!0,formatter:"{value} "+this.deviceInfo.readOnlyList[e].unit,offsetCenter:[0,"80%"],fontSize:20},data:[{value:this.deviceInfo.readOnlyList[e].shadow,name:this.deviceInfo.readOnlyList[e].name}],title:{offsetCenter:[0,"115%"],fontSize:16}}]},t&&i.setOption(t)}}}},u=c,d=i("2877"),m=Object(d["a"])(u,n,a,!1,null,null,null);t["default"]=m.exports},6:function(e,t){},7168:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"padding-left":"20px"}},[i("el-form",{directives:[{name:"show",rawName:"v-show",value:e.showSearch,expression:"showSearch"}],ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[i("el-form-item",{attrs:{label:"类型",prop:"logType"}},[i("el-select",{attrs:{placeholder:"请选择类型",clearable:"",size:"small"},model:{value:e.queryParams.logType,callback:function(t){e.$set(e.queryParams,"logType",t)},expression:"queryParams.logType"}},e._l(e.dict.type.iot_device_log_type,(function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),i("el-form-item",{attrs:{label:"标识符",prop:"identity"}},[i("el-input",{attrs:{placeholder:"请输入标识符",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.identity,callback:function(t){e.$set(e.queryParams,"identity",t)},expression:"queryParams.identity"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.deviceLogList,size:"mini"}},[i("el-table-column",{attrs:{label:"编号",align:"center",prop:"logId",width:"100"}}),i("el-table-column",{attrs:{label:"类型",align:"center",prop:"logType",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.iot_device_log_type,value:t.row.logType}})]}}])}),i("el-table-column",{attrs:{label:"时间",align:"center",prop:"createTime",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.createTime))])]}}])}),i("el-table-column",{attrs:{label:"动作",align:"left","header-align":"center",prop:"logValue"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",{domProps:{innerHTML:e._s(e.formatValueDisplay(t.row))}})]}}])}),i("el-table-column",{attrs:{label:"标识符",align:"center",prop:"identity"}}),i("el-table-column",{attrs:{label:"备注","header-align":"center",align:"left",prop:"remark"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(null==t.row.remark?"无":t.row.remark)+" ")]}}])})],1),i("div",{staticStyle:{height:"40px"}},[i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1)],1)},a=[],r=i("5530"),o=(i("b0c0"),i("a035")),s=i("01ca"),l={name:"DeviceLog",dicts:["iot_device_log_type","iot_yes_no"],props:{device:{type:Object,default:null}},watch:{device:function(e,t){this.deviceInfo=e,this.deviceInfo&&0!=this.deviceInfo.deviceId&&(this.queryParams.deviceId=this.deviceInfo.deviceId,this.getList(),this.getCacheThingsModdel(this.deviceInfo.productId))}},data:function(){return{thingsModel:{},loading:!0,showSearch:!0,total:0,deviceLogList:[],queryParams:{pageNum:1,pageSize:10,logType:null,logValue:null,deviceId:null,deviceName:null,identity:null,isMonitor:null}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(o["a"])(this.queryParams).then((function(t){e.deviceLogList=t.rows,e.total=t.total,e.loading=!1}))},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleExport:function(){this.download("iot/deviceLog/export",Object(r["a"])({},this.queryParams),"deviceLog_".concat((new Date).getTime(),".xlsx"))},getCacheThingsModdel:function(e){var t=this;Object(s["b"])(e).then((function(e){t.thingsModel=JSON.parse(e.data)}))},formatValueDisplay:function(e){if(1==e.logType){var t=this.getThingsModelItem(1,e.identity);if(""!=t)return t.name+'： <span style="color:#409EFF;">'+this.getThingsModelItemValue(t,e.logValue)+" "+(void 0!=t.datatype.unit?t.datatype.unit:"")+"</span>"}else if(2==e.logType){var i=this.getThingsModelItem(2,e.identity);if(""!=i)return i.name+'： <span style="color:#409EFF">'+this.getThingsModelItemValue(i,e.logValue)+" "+(void 0!=i.datatype.unit?i.datatype.unit:"")+"</span>"}else if(3==e.logType){var n=this.getThingsModelItem(3,e.identity);if(""!=n)return n.name+'： <span style="color:#409EFF">'+this.getThingsModelItemValue(n,e.logValue)+" "+(void 0!=n.datatype.unit?n.datatype.unit:"")+"</span>"}else{if(4==e.logType)return'<span style="font-weight:bold">设备升级</span>';if(5==e.logType)return'<span style="font-weight:bold">设备上线</span>';if(6==e.logType)return'<span style="font-weight:bold">设备离线</span>'}return""},getThingsModelItemValue:function(e,t){if("bool"==e.datatype.type){if("0"==t)return e.datatype.falseText;if("1"==t)return e.datatype.trueText}else if("enum"==e.datatype.type)for(var i=0;i<e.datatype.enumList.length;i++)if(t==e.datatype.enumList[i].value)return e.datatype.enumList[i].text;return t},getThingsModelItem:function(e,t){if(1==e&&this.thingsModel.properties){for(var i=0;i<this.thingsModel.properties.length;i++)if(this.thingsModel.properties[i].id==t)return this.thingsModel.properties[i]}else if(2==e&&this.thingsModel.functions){for(var n=0;n<this.thingsModel.functions.length;n++)if(this.thingsModel.functions[n].id==t)return this.thingsModel.functions[n]}else if(3==e&&this.thingsModel.events)for(var a=0;a<this.thingsModel.events.length;a++)if(this.thingsModel.events[a].id==t)return this.thingsModel.events[a];return""}}},c=l,u=i("2877"),d=Object(u["a"])(c,n,a,!1,null,null,null);t["default"]=d.exports},"7d04":function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("span")},a=[],r=(i("b0c0"),i("d3b7"),i("25f0"),i("a15b"),i("e7fc")),o=i.n(r),s=i("5f87"),l={name:"mqttClient",props:{publish:{type:Object,default:null},subscribes:{type:Array,default:null}},watch:{publish:function(e,t){this.mqttPublish(e.topic,e.message,e.name)},subscribes:function(e,t){this.connectMqtt(e)}},data:function(){return{deviceInfo:{}}},created:function(){},methods:{connectMqtt:function(e){var t=this,i={username:"wumei-smart",password:Object(s["a"])(),cleanSession:!1,keepAlive:30,clientId:"web-"+Math.random().toString(16).substr(2),connectTimeout:6e4},n="ws://"+window.location.hostname+":8083/mqtt";console.log("mqtt地址：",n),this.client=o.a.connect(n,i),this.client.on("connect",(function(i){console.log("成功连接服务器:",i),t.client.subscribe(e,{qos:1},(function(t){t?console.log("消息订阅失败！"):(console.log("订阅成功"),console.log(e.join(", ")))}))})),this.reconnectMqtt(),this.mqttError(),this.mqttSubscribe()},mqttPublish:function(e,t,i){var n=this;if(!this.client.connected)return console.log("客户端未连接"),void this.$modal.notifyError("Mqtt客户端未连接");this.client.publish(e,t,{qos:1},(function(a){a||(console.log("成功发布主题："+e),console.log("主题内容："+t),n.$modal.notifySuccess("[ "+i+" ] 指令发送成功"))}))},mqttSubscribe:function(){var e=this;this.client.on("message",(function(t,i){console.log("收到来自",t,"的信息",i.toString());var n={};n.topic=t,n.message=JSON.parse(i.toString()),e.$emit("callbackEvent",n)}))},mqttError:function(){var e=this;this.client.on("error",(function(t){console.log("连接失败：",t),e.$modal.notifyError("Mqtt客户端连接失败"),e.client.end()}))},unsubscribeMqtt:function(){var e=this;this.client.unsubscribe(this.mtopic,(function(t){console.log("主题为"+e.mtopic+"取消订阅成功",t)}))},unconnectMqtt:function(){this.client.end(),this.client=null,console.log("服务器已断开连接！"),this.$modal.notifyError("Mqtt服务器已断开连接！")},reconnectMqtt:function(){this.client.on("reconnect",(function(e){console.log("正在重连:",e)}))}}},c=l,u=i("2877"),d=Object(u["a"])(c,n,a,!1,null,null,null);t["default"]=d.exports},"9b9c":function(e,t,i){"use strict";i.d(t,"e",(function(){return a})),i.d(t,"f",(function(){return r})),i.d(t,"d",(function(){return o})),i.d(t,"a",(function(){return s})),i.d(t,"g",(function(){return l})),i.d(t,"b",(function(){return c})),i.d(t,"c",(function(){return u}));var n=i("b775");function a(e){return Object(n["a"])({url:"/iot/product/list",method:"get",params:e})}function r(){return Object(n["a"])({url:"/iot/product/shortList",method:"get"})}function o(e){return Object(n["a"])({url:"/iot/product/"+e,method:"get"})}function s(e){return Object(n["a"])({url:"/iot/product",method:"post",data:e})}function l(e){return Object(n["a"])({url:"/iot/product",method:"put",data:e})}function c(e){return Object(n["a"])({url:"/iot/product/status/",method:"put",data:e})}function u(e){return Object(n["a"])({url:"/iot/product/"+e,method:"delete"})}},a035:function(e,t,i){"use strict";i.d(t,"a",(function(){return a})),i.d(t,"b",(function(){return r}));var n=i("b775");function a(e){return Object(n["a"])({url:"/iot/deviceLog/list",method:"get",params:e})}function r(e){return Object(n["a"])({url:"/iot/deviceLog/monitor",method:"get",params:e})}},a45f:function(e,t,i){"use strict";i.r(t),i.d(t,"loadBMap",(function(){return n}));i("d3b7");function n(){var e="nAtaBg9FYzav6c8P9rF9qzsWZfT8O0PD";return new Promise((function(t,i){if("undefined"!==typeof BMap)return t(BMap),!0;window.onBMapCallback=function(){t(BMap)};var n=document.createElement("script");n.type="text/javascript",n.src="http://api.map.baidu.com/api?v=2.0&ak="+e+"&__ec_v__=20190126&callback=onBMapCallback",n.onerror=i,document.head.appendChild(n)}))}},b52e:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"padding-left":"20px"}},[i("el-row",{staticClass:"mb8",attrs:{gutter:10}},[i("el-col",{attrs:{span:1.5}},[i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:deviceUser:add"],expression:"['iot:deviceUser:add']"}],attrs:{type:"primary",plain:"",icon:"el-icon-plus",size:"mini"},on:{click:e.selectUser}},[e._v("分享设备")])],1),i("right-toolbar",{on:{queryTable:e.getList}})],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.deviceUserList,size:"mini"},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{label:"用户昵称",align:"center",prop:"userName",width:"200"}}),i("el-table-column",{attrs:{label:"手机号码",align:"center",prop:"phonenumber",width:"200"}}),i("el-table-column",{attrs:{label:"设备所有者",align:"center",prop:"isOwner",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.iot_yes_no,value:t.row.isOwner}})]}}])}),i("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.parseTime(t.row.createTime,"{y}-{m}-{d}")))])]}}])}),i("el-table-column",{attrs:{label:"备注",align:"left",prop:"remark",al:""}}),i("el-table-column",{attrs:{label:"操作",align:"center","class-name":"small-padding fixed-width",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.isOwner?i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:deviceUser:edit"],expression:"['iot:deviceUser:edit']"}],attrs:{size:"mini",type:"text",icon:"el-icon-edit"},on:{click:function(i){return e.handleUpdate(t.row)}}},[e._v("备注")]):e._e(),0==t.row.isOwner?i("el-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:["iot:deviceUser:remove"],expression:"['iot:deviceUser:remove']"}],attrs:{size:"mini",type:"text",icon:"el-icon-delete"},on:{click:function(i){return e.handleDelete(t.row)}}},[e._v("删除")]):e._e()]}}])})],1),i("el-dialog",{attrs:{title:e.title,visible:e.open,width:"500px","append-to-body":""},on:{"update:visible":function(t){e.open=t}}},[i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"备注",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",rows:"8"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("确 定")]),i("el-button",{on:{click:e.cancel}},[e._v("取 消")])],1)],1),i("user-list",{ref:"userList",attrs:{device:e.device}})],1)},a=[],r=i("5530"),o=(i("d81d"),i("e018")),s=i("2544"),l={name:"device-user",dicts:["iot_yes_no"],components:{userList:o["default"]},props:{device:{type:Object,default:null}},watch:{device:function(e,t){this.deviceInfo=e,this.deviceInfo&&0!=this.deviceInfo.deviceId&&(this.queryParams.deviceId=this.deviceInfo.deviceId,this.getList())}},data:function(){return{loading:!0,ids:[],single:!0,multiple:!0,showSearch:!0,total:0,deviceUserList:[],title:"",open:!1,queryParams:{pageNum:1,pageSize:10,deviceName:null,userName:null,tenantName:null,isOwner:null},form:{},rules:{deviceName:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],userName:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}]}}},created:function(){this.getList()},methods:{getList:function(){var e=this;this.loading=!0,Object(s["d"])(this.queryParams).then((function(t){e.deviceUserList=t.rows,e.total=t.total,e.loading=!1}))},cancel:function(){this.open=!1,this.reset()},reset:function(){this.form={deviceId:null,userId:null,deviceName:null,userName:null,tenantId:null,tenantName:null,isOwner:null,limitNum:null,delFlag:null,createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null},this.resetForm("form")},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.deviceId})),this.single=1!==e.length,this.multiple=!e.length},handleAdd:function(){this.reset(),this.open=!0,this.title="添加设备用户"},handleUpdate:function(e){var t=this;this.reset();var i=e.deviceId||this.ids;Object(s["c"])(i).then((function(e){t.form=e.data,t.open=!0,t.title="用户备注"}))},submitForm:function(){var e=this;null!=this.form.deviceId&&Object(s["e"])(this.form).then((function(t){e.$modal.msgSuccess("备注成功"),e.open=!1,e.getList()}))},handleDelete:function(e){var t=this,i=e.deviceId||this.ids;this.$modal.confirm('是否确认删除设备用户编号为"'+i+'"的数据项？').then((function(){return Object(s["b"])(i)})).then((function(){t.getList(),t.$modal.msgSuccess("删除成功")})).catch((function(){}))},handleExport:function(){this.download("iot/deviceUser/export",Object(r["a"])({},this.queryParams),"deviceUser_".concat((new Date).getTime(),".xlsx"))},selectUser:function(){this.$refs.userList.openSelectUser=!0}}},c=l,u=i("2877"),d=Object(u["a"])(c,n,a,!1,null,null,null);t["default"]=d.exports},c0c7:function(e,t,i){"use strict";i.d(t,"g",(function(){return r})),i.d(t,"e",(function(){return o})),i.d(t,"a",(function(){return s})),i.d(t,"j",(function(){return l})),i.d(t,"c",(function(){return c})),i.d(t,"h",(function(){return u})),i.d(t,"b",(function(){return d})),i.d(t,"f",(function(){return m})),i.d(t,"k",(function(){return p})),i.d(t,"l",(function(){return f})),i.d(t,"m",(function(){return h})),i.d(t,"d",(function(){return v})),i.d(t,"i",(function(){return b}));var n=i("b775"),a=i("c38a");function r(e){return Object(n["a"])({url:"/system/user/list",method:"get",params:e})}function o(e){return Object(n["a"])({url:"/system/user/"+Object(a["f"])(e),method:"get"})}function s(e){return Object(n["a"])({url:"/system/user",method:"post",data:e})}function l(e){return Object(n["a"])({url:"/system/user",method:"put",data:e})}function c(e){return Object(n["a"])({url:"/system/user/"+e,method:"delete"})}function u(e,t){var i={userId:e,password:t};return Object(n["a"])({url:"/system/user/resetPwd",method:"put",data:i})}function d(e,t){var i={userId:e,status:t};return Object(n["a"])({url:"/system/user/changeStatus",method:"put",data:i})}function m(){return Object(n["a"])({url:"/system/user/profile",method:"get"})}function p(e){return Object(n["a"])({url:"/system/user/profile",method:"put",data:e})}function f(e,t){var i={oldPassword:e,newPassword:t};return Object(n["a"])({url:"/system/user/profile/updatePwd",method:"put",params:i})}function h(e){return Object(n["a"])({url:"/system/user/profile/avatar",method:"post",data:e})}function v(e){return Object(n["a"])({url:"/system/user/authRole/"+e,method:"get"})}function b(e){return Object(n["a"])({url:"/system/user/authRole",method:"put",params:e})}},e018:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"选择产品",visible:e.openSelectUser,width:"800px"},on:{"update:visible":function(t){e.openSelectUser=t}}},[i("div",{staticStyle:{"margin-top":"-50px"}},[i("el-divider")],1),i("el-form",{ref:"queryForm",attrs:{model:e.queryParams,rules:e.rules,inline:!0,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"手机号码",prop:"phonenumber"}},[i("el-input",{staticStyle:{width:"240px"},attrs:{type:"text",placeholder:"请输入用户手机号码",minlength:"10",clearable:"",size:"small","show-word-limit":""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.phonenumber,callback:function(t){e.$set(e.queryParams,"phonenumber",t)},expression:"queryParams.phonenumber"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("查询")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.userList,"highlight-current-row":"",size:"mini",border:""},on:{"current-change":e.handleCurrentChange}},[i("el-table-column",{attrs:{label:"选择",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("input",{attrs:{type:"radio",name:"user"},domProps:{checked:e.row.isSelect}})]}}])}),i("el-table-column",{key:"nickName",attrs:{label:"用户昵称",align:"center",prop:"nickName","show-overflow-tooltip":!0}}),i("el-table-column",{key:"phonenumber",attrs:{label:"手机号码",align:"center",prop:"phonenumber",width:"120"}}),i("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])})],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.addDeviceUser}},[e._v("添加")]),i("el-button",{on:{click:e.closeSelectUser}},[e._v("关 闭")])],1)],1)},a=[],r=i("c0c7"),o=i("2544"),s={name:"user-list",props:{device:{type:Object,default:null}},watch:{device:function(e,t){this.deviceInfo=e}},data:function(){return{loading:!1,ids:[],title:"",userList:[],user:{},deviceInfo:{},openSelectUser:!1,queryParams:{pageNum:1,pageSize:10,userName:void 0,phonenumber:void 0,status:0,deptId:void 0},rules:{phonenumber:[{required:!0,message:"手机号码不能为空",trigger:"blur"},{min:11,max:11,message:"手机号码长度为11位",trigger:"blur"}]}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,Object(r["g"])(this.addDateRange(this.queryParams,this.dateRange)).then((function(t){e.userList=t.rows,e.total=t.total,e.loading=!1}))},handleQuery:function(){var e=this;this.$refs["queryForm"].validate((function(t){t&&(e.queryParams.pageNum=1,e.getList())}))},resetQuery:function(){this.$refs["queryForm"].resetFields(),this.userList=[]},setRadioSelected:function(e){for(var t=0;t<this.userList.length;t++)this.userList[t].userId==e?(this.userList[t].isSelect=!0,this.user=this.userList[t]):this.userList[t].isSelect=!1},handleCurrentChange:function(e){null!=e&&(this.setRadioSelected(e.userId),this.user=e)},closeSelectUser:function(){this.openSelectUser=!1,this.resetQuery()},addDeviceUser:function(){var e=this;if(null!=this.deviceInfo.deviceId){var t={};t.deviceId=this.deviceInfo.deviceId,t.deviceName=this.deviceInfo.deviceName,t.userId=this.user.userId,t.userName=this.user.userName,t.phonenumber=this.user.phonenumber,Object(o["a"])(t).then((function(t){e.$modal.msgSuccess("新增成功"),e.resetQuery(),e.openSelectUser=!1,e.$parent.getList()}))}}}},l=s,c=i("2877"),u=Object(c["a"])(l,n,a,!1,null,null,null);t["default"]=u.exports},e51f:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{title:"选择产品",visible:e.open,width:"800px"},on:{"update:visible":function(t){e.open=t}}},[i("div",{staticStyle:{"margin-top":"-55px"}},[i("el-divider",{staticStyle:{"margin-top":"-30px"}}),i("el-form",{ref:"queryForm",attrs:{model:e.queryParams,inline:!0,"label-width":"68px"}},[i("el-form-item",{attrs:{label:"产品名称",prop:"productName"}},[i("el-input",{attrs:{placeholder:"请输入产品名称",clearable:"",size:"small"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleQuery(t)}},model:{value:e.queryParams.productName,callback:function(t){e.$set(e.queryParams,"productName",t)},expression:"queryParams.productName"}})],1),i("el-form-item",[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:e.handleQuery}},[e._v("搜索")]),i("el-button",{attrs:{icon:"el-icon-refresh",size:"mini"},on:{click:e.resetQuery}},[e._v("重置")])],1)],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"singleTable",attrs:{data:e.productList,"highlight-current-row":"",border:"",size:"mini"},on:{"current-change":e.handleCurrentChange}},[i("el-table-column",{attrs:{label:"选择",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("input",{attrs:{type:"radio",name:"product"},domProps:{checked:e.row.isSelect}})]}}])}),i("el-table-column",{attrs:{label:"产品名称",align:"center",prop:"productName"}}),i("el-table-column",{attrs:{label:"分类名称",align:"center",prop:"categoryName"}}),i("el-table-column",{attrs:{label:"状态",align:"center",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.iot_product_status,value:t.row.status}})]}}])}),i("el-table-column",{attrs:{label:"联网方式",align:"center",prop:"networkMethod"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("dict-tag",{attrs:{options:e.dict.type.iot_network_method,value:t.row.networkMethod}})]}}])}),i("el-table-column",{attrs:{label:"创建时间",align:"center",prop:"createTime",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.parseTime(t.row.createTime,"{y}-{m}-{d}")))])]}}])})],1),i("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total>0"}],attrs:{total:e.total,page:e.queryParams.pageNum,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNum",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getList}})],1),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:e.confirmSelectProduct}},[e._v("确定")]),i("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("关 闭")])],1)])},a=[],r=(i("a9e3"),i("b0c0"),i("9b9c")),o={name:"Product",dicts:["iot_product_status","iot_network_method"],props:{productId:{type:Number,default:0}},data:function(){return{loading:!0,total:0,open:!1,productList:[],product:{},queryParams:{pageNum:1,pageSize:10,productName:null,categoryId:null,categoryName:null,tenantId:null,tenantName:null,isSys:null,status:2,deviceType:null,networkMethod:null}}},created:function(){},methods:{getList:function(){var e=this;this.loading=!0,-1===this.$store.state.user.roles.indexOf("admin")&&(this.queryParams.tenantName=this.$store.state.user.name),Object(r["e"])(this.queryParams).then((function(t){e.productList=t.rows,e.total=t.total,0!=e.productId&&e.setRadioSelected(e.productId),e.loading=!1}))},handleQuery:function(){this.queryParams.pageNum=1,this.getList()},resetQuery:function(){this.resetForm("queryForm"),this.handleQuery()},handleCurrentChange:function(e){null!=e&&(this.setRadioSelected(e.productId),this.product=e)},setRadioSelected:function(e){for(var t=0;t<this.productList.length;t++)this.productList[t].productId==e?this.productList[t].isSelect=!0:this.productList[t].isSelect=!1},confirmSelectProduct:function(){this.$emit("productEvent",this.product),this.open=!1},closeDialog:function(){this.open=!1}}},s=o,l=i("2877"),c=Object(l["a"])(s,n,a,!1,null,null,null);t["default"]=c.exports},e626:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-card",{staticStyle:{margin:"6px","padding-bottom":"100px"}},[i("el-tabs",{staticStyle:{padding:"10px"},attrs:{"tab-position":"left"},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[i("el-tab-pane",{attrs:{name:"basic"}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v(" * 基本信息")]),i("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules,"label-width":"100px"}},[i("el-row",{attrs:{gutter:100}},[i("el-col",{attrs:{xs:24,sm:24,md:24,lg:12,xl:8}},[i("el-form-item",{attrs:{label:"设备名称",prop:"deviceName"}},[i("el-input",{attrs:{placeholder:"请输入设备名称"},model:{value:e.form.deviceName,callback:function(t){e.$set(e.form,"deviceName",t)},expression:"form.deviceName"}})],1),i("el-form-item",{attrs:{label:"",prop:"serialNumber"}},[i("template",{slot:"label"},[i("span",{staticStyle:{color:"red"}},[e._v("* ")]),e._v("设备编号 ")]),i("el-input",{attrs:{placeholder:"请输入设备编号",disabled:1!=e.form.status},model:{value:e.form.serialNumber,callback:function(t){e.$set(e.form,"serialNumber",t)},expression:"form.serialNumber"}},[i("el-button",{attrs:{slot:"append",loading:e.genDisabled,disabled:1!=e.form.status},on:{click:e.generateNum},slot:"append"},[e._v("生成")])],1)],2),i("el-form-item",{attrs:{label:"",prop:"productName"}},[i("template",{slot:"label"},[i("span",{staticStyle:{color:"red"}},[e._v("* ")]),e._v("所属产品 ")]),i("el-input",{attrs:{readonly:"",placeholder:"请选择产品",disabled:1!=e.form.status},model:{value:e.form.productName,callback:function(t){e.$set(e.form,"productName",t)},expression:"form.productName"}},[i("el-button",{attrs:{slot:"append",disabled:1!=e.form.status},on:{click:function(t){return e.selectProduct()}},slot:"append"},[e._v("选择")])],1)],2),i("el-form-item",{attrs:{label:"固件版本",prop:"firmwareVersion"}},[i("el-input",{attrs:{placeholder:"请输入固件版本",type:"number",disabled:1!=e.form.status},model:{value:e.form.firmwareVersion,callback:function(t){e.$set(e.form,"firmwareVersion",t)},expression:"form.firmwareVersion"}},[i("template",{slot:"prepend"},[e._v("Version")])],2)],1),i("el-form-item",{attrs:{label:"禁用设备",prop:"deviceStatus"}},[i("el-switch",{attrs:{"active-text":"","inactive-text":"",disabled:1==e.form.status,"active-value":1,"inactive-value":0,"active-color":"#F56C6C"},model:{value:e.deviceStatus,callback:function(t){e.deviceStatus=t},expression:"deviceStatus"}})],1),i("el-form-item",{attrs:{label:"设备影子",prop:"isShadow"}},[i("el-switch",{attrs:{"active-text":"","inactive-text":"","active-value":1,"inactive-value":0},model:{value:e.form.isShadow,callback:function(t){e.$set(e.form,"isShadow",t)},expression:"form.isShadow"}})],1),i("el-form-item",{attrs:{label:"备注信息",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",placeholder:"请输入内容",rows:"3"},model:{value:e.form.remark,callback:function(t){e.$set(e.form,"remark",t)},expression:"form.remark"}})],1)],1),i("el-col",{attrs:{xs:24,sm:24,md:24,lg:12,xl:8}},[i("el-form-item",{attrs:{label:"自定义位置",prop:"isCustomLocation"}},[i("el-switch",{attrs:{"active-text":"","inactive-text":"","active-value":1,"inactive-value":0},model:{value:e.form.isCustomLocation,callback:function(t){e.$set(e.form,"isCustomLocation",t)},expression:"form.isCustomLocation"}})],1),i("el-form-item",{attrs:{label:"设备经度",prop:"longitude"}},[i("el-input",{attrs:{placeholder:"请输入设备经度",type:"number",disabled:0==e.form.isCustomLocation},model:{value:e.form.longitude,callback:function(t){e.$set(e.form,"longitude",t)},expression:"form.longitude"}},[i("el-link",{attrs:{slot:"append",underline:!1,href:"https://api.map.baidu.com/lbsapi/getpoint/index.html",target:"_blank"},slot:"append"},[e._v("坐标拾取")])],1)],1),i("el-form-item",{attrs:{label:"设备纬度",prop:"latitude"}},[i("el-input",{attrs:{placeholder:"请输入设备纬度",type:"number",disabled:0==e.form.isCustomLocation},model:{value:e.form.latitude,callback:function(t){e.$set(e.form,"latitude",t)},expression:"form.latitude"}},[i("el-link",{attrs:{slot:"append",underline:!1,href:"https://api.map.baidu.com/lbsapi/getpoint/index.html",target:"_blank"},slot:"append"},[e._v("坐标拾取")])],1)],1),i("el-form-item",{attrs:{label:"所在地址",prop:"networkAddress"}},[i("el-input",{attrs:{placeholder:"请输入设备所在地址",disabled:0==e.form.isCustomLocation},model:{value:e.form.networkAddress,callback:function(t){e.$set(e.form,"networkAddress",t)},expression:"form.networkAddress"}})],1),i("el-form-item",{attrs:{label:"入网地址",prop:"networkIp"}},[i("el-input",{attrs:{placeholder:"设备入网IP",disabled:""},model:{value:e.form.networkIp,callback:function(t){e.$set(e.form,"networkIp",t)},expression:"form.networkIp"}})],1),i("el-form-item",{attrs:{label:"激活时间",prop:"activeTime"}},[i("el-date-picker",{staticStyle:{width:"100%"},attrs:{clearable:"",type:"date","value-format":"yyyy-MM-dd",placeholder:"设备激活时间",disabled:""},model:{value:e.form.activeTime,callback:function(t){e.$set(e.form,"activeTime",t)},expression:"form.activeTime"}})],1),i("el-form-item",{attrs:{label:"设备信号",prop:"rssi"}},[i("el-input",{attrs:{placeholder:"设备信号强度",disabled:""},model:{value:e.form.rssi,callback:function(t){e.$set(e.form,"rssi",t)},expression:"form.rssi"}})],1),i("el-form-item",{attrs:{label:"设备状态",prop:"status"}},[i("dict-tag",{staticStyle:{width:"60px",display:"inline-block"},attrs:{options:e.dict.type.iot_device_status,value:e.form.status}})],1)],1),i("el-col",{attrs:{xs:24,sm:24,md:24,lg:12,xl:8}},[i("div",{staticStyle:{border:"1px solid #dfe4ed","border-radius":"5px",padding:"5px","text-align":"center","line-height":"400px"}},[i("div",{staticStyle:{height:"435px",width:"100%"},attrs:{id:"map"}},[e._v("地图展示区域，新增后显示")])])])],1)],1),i("el-form",{staticStyle:{"margin-top":"50px"},attrs:{"label-width":"100px"}},[i("el-form-item",{staticStyle:{"text-align":"center","margin-left":"-100px","margin-top":"10px"}},[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.submitForm}},[e._v("保 存")])],1)],1),i("product-list",{ref:"productList",attrs:{productId:e.form.productId},on:{productEvent:function(t){return e.getProductData(t)}}})],1),i("el-tab-pane",{attrs:{name:"runningStatus",disabled:0==e.form.deviceId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("运行状态")]),i("running-status",{ref:"runningStatus",attrs:{device:e.form}})],1),i("el-tab-pane",{attrs:{name:"deviceTimer",disabled:0==e.form.deviceId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("设备定时")]),i("device-timer",{ref:"deviceTimer",attrs:{device:e.form}})],1),i("el-tab-pane",{attrs:{name:"deviceLog",disabled:0==e.form.deviceId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("设备日志")]),i("device-log",{ref:"deviceLog",attrs:{device:e.form}})],1),i("el-tab-pane",{attrs:{name:"deviceStastic",disabled:0==e.form.deviceId}},[i("span",{attrs:{slot:"label"},slot:"label"},[e._v("监测统计")]),i("device-statistic",{ref:"deviceStatistic",attrs:{device:e.form}})],1),i("el-tab-pane",{attrs:{label:"",disabled:"",name:"device01"}}),i("el-tab-pane",{attrs:{label:"",disabled:"",name:"device02"}}),i("el-tab-pane",{attrs:{label:"",disabled:"",name:"device03"}}),i("el-tab-pane",{attrs:{name:"device04"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"用于查看发送的指令，设备是否已经响应",placement:"right-start"}},[i("el-button",{attrs:{type:"success",size:"mini",disabled:0==e.form.deviceId},on:{click:function(t){return e.dataSynchronization()}}},[e._v("数据同步")])],1)],1)]),i("el-tab-pane",{attrs:{name:"device05"}},[i("span",{attrs:{slot:"label"},slot:"label"},[i("el-button",{attrs:{type:"info",size:"mini",disabled:!e.isLoaded},on:{click:function(t){return e.goBack()}}},[e._v("返回列表")])],1)])],1)],1)},a=[],r=(i("d81d"),i("e51f")),o=i("7168"),s=i("b52e"),l=i("5f43"),c=i("f14e"),u=i("7a72"),d=i("a45f"),m=i("584f"),p={name:"DeviceEdit",dicts:["iot_device_status"],components:{deviceLog:o["default"],deviceUser:s["default"],deviceStatistic:c["default"],runningStatus:l["default"],productList:r["default"],deviceTimer:u["default"]},watch:{activeName:function(e){"deviceStastic"==e&&this.$nextTick((function(){}))}},data:function(){return{isLoaded:!1,genDisabled:!1,activeName:"basic",loading:!0,deviceStatus:0,form:{productId:0,status:1},imageUrl:i("32d1"),baseUrl:"/prod-api",map:null,local:null,mk:null,latitude:"",longitude:"",keyWords:"",rules:{deviceName:[{required:!0,message:"设备名称不能为空",trigger:"blur"}],firmwareVersion:[{required:!0,message:"固件版本不能为空",trigger:"blur"}]}}},created:function(){var e=this;this.form.deviceId=this.$route.query&&this.$route.query.deviceId,0!=this.form.deviceId&&this.getDevice(this.form.deviceId),setTimeout((function(){e.isLoaded=!0}),2e3)},methods:{dataSynchronization:function(){var e=this;Object(m["d"])(this.form.deviceId).then((function(t){e.form=t.data,e.activeName="runningStatus",2==e.form.status&&(e.deviceStatus=1),null!=e.form.imgUrl&&""!=e.form.imgUrl&&(e.imageUrl=e.form.imgUrl),e.loadMap()}))},getDevice:function(e){var t=this;Object(m["d"])(e).then((function(e){t.form=e.data,2==t.form.status&&(t.deviceStatus=1),null!=t.form.imgUrl&&""!=t.form.imgUrl&&(t.imageUrl=t.form.imgUrl),t.loadMap()}))},loadMap:function(){var e=this;this.$nextTick((function(){Object(d["loadBMap"])().then((function(){e.getmap()}))}))},goBack:function(){var e={path:"/iot/device",query:{t:Date.now(),pageNum:this.$route.query.pageNum}};this.$tab.closeOpenPage(e),this.reset()},reset:function(){this.form={deviceId:0,deviceName:null,productId:null,productName:null,userId:null,userName:null,tenantId:null,tenantName:null,serialNumber:null,firmwareVersion:null,status:1,rssi:null,networkAddress:null,networkIp:null,longitude:null,latitude:null,activeTime:null,createBy:null,createTime:null,updateBy:null,updateTime:null,remark:null,isCustomLocation:0},this.deviceStatus=0,this.resetForm("form")},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){t&&(0!=e.form.deviceId?(e.setDeviceStatus(),console.log(e.form),Object(m["h"])(e.form).then((function(t){e.$modal.alertSuccess("修改成功"),e.open=!1,e.loadMap()}))):Object(m["a"])(e.form).then((function(t){e.$modal.alertSuccess("新增成功, 可以烧录sdk到设备了"),e.open=!1,e.form=t.data,2==e.form.status&&(e.deviceStatus=1),e.loadMap()})))}))},selectProduct:function(){this.$refs.productList.open=!0,this.$refs.productList.getList()},getProductData:function(e){this.form.productId=e.productId,this.form.productName=e.productName,console.log(e)},getUserData:function(e){},getmap:function(){this.map=new BMap.Map("map");var e=null;e=null!=this.form.longitude&&""!=this.form.longitude&&null!=this.form.latitude&&""!=this.form.latitude?new BMap.Point(this.form.longitude,this.form.latitude):new BMap.Point(116.404,39.915),this.map.centerAndZoom(e,19),this.map.enableScrollWheelZoom(!0),this.map.addControl(new BMap.NavigationControl),this.mk=new BMap.Marker(e),this.map.addOverlay(this.mk),this.map.panTo(e)},setDeviceStatus:function(){1==this.deviceStatus?this.form.status=2:2==this.form.status&&(this.form.status=4)},generateNum:function(){var e=this;this.genDisabled=!0,Object(m["c"])().then((function(t){e.form.serialNumber=t.data,e.genDisabled=!1}))}}},f=p,h=i("2877"),v=Object(h["a"])(f,n,a,!1,null,null,null);t["default"]=v.exports},f14e:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{"padding-left":"20px"}},[i("el-row",[i("el-col",{attrs:{span:24}},e._l(e.monitorThings,(function(e,t){return i("div",{key:t,staticStyle:{"margin-bottom":"50px"}},[i("el-card",{attrs:{shadow:"hover","body-style":{padding:"10px 0px",overflow:"auto"}}},[i("div",{ref:"statisticMap",refInFor:!0,staticStyle:{height:"250px",width:"1470px"}})])],1)})),0)],1)],1)},a=[],r=(i("4de4"),i("d3b7"),i("b0c0"),i("313e")),o=i("01ca"),s=i("a035"),l={name:"device-statistic",props:{device:{type:Object,default:null}},watch:{device:function(e,t){this.deviceInfo=e,this.deviceInfo&&0!=this.deviceInfo.deviceId&&this.getCacheThingsModdel(this.deviceInfo.productId)}},data:function(){return{deviceInfo:{},monitorThings:[],chart:[]}},mounted:function(){},methods:{getCacheThingsModdel:function(e){var t=this;Object(o["b"])(e).then((function(e){var i=JSON.parse(e.data);t.monitorThings=i.properties.filter((function(e){return 1==e.isMonitor})),t.$nextTick((function(){this.getStatistic(),this.getStatisticData(this.monitorThings)}))}))},getStatisticData:function(e){for(var t=this,i=function(i){var n={};n.deviceId=t.deviceInfo.deviceId,n.identity=e[i].id,Object(s["b"])(n).then((function(e){for(var n=e.rows,a=[],r=0;r<n.length;r++){var o=[];o[0]=n[r].time,o[1]=n[r].value,a.push(o)}t.chart[i].setOption({series:[{data:a}]})}))},n=0;n<e.length;n++)i(n)},getStatistic:function(){for(var e=0;e<this.monitorThings.length;e++){var t;this.chart[e]=r["init"](this.$refs.statisticMap[e]),t={animationDurationUpdate:3e3,tooltip:{trigger:"axis"},title:{left:"center",text:this.monitorThings[e].name+"统计 （单位 "+(void 0!=this.monitorThings[e].datatype.unit?this.monitorThings[e].datatype.unit:"无")+"）"},grid:{top:"80px",left:"40px",right:"80px",bottom:"60px",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},xAxis:{type:"time",boundaryGap:!1,name:"时间",nameLocation:"end",nameTextStyle:{fontSize:16,padding:20}},yAxis:{type:"value",boundaryGap:[0,"100%"],name:this.monitorThings[e].name,nameLocation:"end",nameTextStyle:{fontSize:16,padding:10}},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}],series:[{name:this.monitorThings[e].name,type:"line",symbol:"none",sampling:"lttb",itemStyle:{color:"rgb(64, 158, 255)"},areaStyle:{color:new r["graphic"].LinearGradient(0,0,0,1,[{offset:0,color:"rgb(64, 158, 255)"},{offset:1,color:"rgb(255, 255, 255)"}])},data:[]}]},t&&this.chart[e].setOption(t)}}}},c=l,u=i("2877"),d=Object(u["a"])(c,n,a,!1,null,null,null);t["default"]=d.exports}}]);